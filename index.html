<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Georgia Transport Live</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --primary: #5d5fef; --bg: #f4f7ff; --text: #2d3142; }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        .header { background: white; padding: 15px 20px; border-radius: 0 0 35px 35px; box-shadow: 0 4px 25px rgba(0,0,0,0.06); z-index: 1000; }
        .header-main { display: flex; justify-content: space-between; align-items: center; }
        .brand h1 { margin: 0; font-size: 20px; color: var(--text); font-weight: 800; }
        .brand p { margin: 3px 0 0; font-size: 12px; color: #9196b2; }
        
        .city-tag { background: #eef2ff; color: var(--primary); padding: 5px 12px; border-radius: 12px; font-size: 12px; font-weight: bold; border: 1px solid #dbeafe; }

        #map { flex: 1; width: 100%; z-index: 1; }

        .panel { background: white; height: 40%; border-radius: 40px 40px 0 0; padding: 25px 20px; overflow-y: auto; z-index: 1000; box-shadow: 0 -10px 30px rgba(0,0,0,0.05); }
        .p-title { font-size: 18px; font-weight: 800; margin-bottom: 15px; display: block; }
        
        .stop-card { background: #fff; border: 1px solid #f0f2f8; padding: 15px; border-radius: 20px; display: flex; align-items: center; margin-bottom: 12px; gap: 15px; }
        .stop-icon { width: 45px; height: 45px; background: var(--primary); color: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .stop-info b { font-size: 15px; color: var(--text); display: block; }
        .stop-info span { font-size: 12px; color: #9196b2; }

        .leaflet-control-zoom, .leaflet-control-attribution { display: none; }
    </style>
</head>
<body onload="initApp()">

<div class="header">
    <div class="header-main">
        <div class="brand">
            <h1>áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒáƒ¡ áƒ¢áƒ áƒáƒœáƒ¡áƒáƒáƒ áƒ¢áƒ˜</h1>
            <p id="city-name">áƒ•áƒ”áƒ«áƒ”áƒ‘ áƒ—áƒ¥áƒ•áƒ”áƒœáƒ¡ áƒ¥áƒáƒšáƒáƒ¥áƒ¡...</p>
        </div>
        <div class="city-tag" id="status-tag">GPS áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜áƒ</div>
    </div>
</div>

<div id="map"></div>

<div class="panel">
    <span class="p-title">áƒ£áƒáƒ®áƒšáƒáƒ”áƒ¡áƒ˜ áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ”áƒ‘áƒ˜</span>
    <div id="stop-list">
        <p style="text-align:center; color:#adb5bd; padding-top:20px;">áƒ›áƒ˜áƒ›áƒ“áƒ˜áƒœáƒáƒ áƒ”áƒáƒ‘áƒ¡ áƒšáƒáƒ™áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ“áƒáƒ“áƒ’áƒ”áƒœáƒ...</p>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    let map = L.map('map', { zoomControl: false }).setView([42.2662, 42.7180], 8); // áƒ›áƒ—áƒ”áƒšáƒ˜ áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒ
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

    function initApp() {
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(pos => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;
                
                map.flyTo([lat, lon], 16);
                
                L.circleMarker([lat, lon], {
                    radius: 8, color: 'white', fillColor: '#5d5fef', fillOpacity: 1, weight: 3
                }).addTo(map);

                getCityName(lat, lon);
                findNearbyStops(lat, lon);
            }, null, { enableHighAccuracy: true });
        }
    }

    // áƒ¥áƒáƒšáƒáƒ¥áƒ˜áƒ¡ áƒáƒ›áƒáƒªáƒœáƒáƒ‘áƒ (áƒ–áƒ£áƒ’áƒ“áƒ˜áƒ“áƒ˜, áƒ—áƒ‘áƒ˜áƒšáƒ˜áƒ¡áƒ˜ áƒ“áƒ áƒ.áƒ¨.)
    async function getCityName(lat, lon) {
        try {
            const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
            const data = await res.json();
            const city = data.address.city || data.address.town || data.address.village || "áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒ";
            document.getElementById('city-name').innerText = `áƒ—áƒ¥áƒ•áƒ”áƒœ áƒ˜áƒ›áƒ§áƒáƒ¤áƒ”áƒ‘áƒ˜áƒ—: ${city}`;
        } catch (e) {
            document.getElementById('city-name').innerText = "áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒáƒ¡ áƒ›áƒáƒ¡áƒ¨áƒ¢áƒáƒ‘áƒ˜áƒ—";
        }
    }

    // áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ”áƒ‘áƒ˜áƒ¡ áƒáƒáƒ•áƒœáƒ áƒ áƒ£áƒ™áƒáƒ–áƒ” (Overpass API - áƒ›áƒ—áƒ”áƒšáƒ˜ áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒáƒ¡áƒ—áƒ•áƒ˜áƒ¡)
    async function findNearbyStops(lat, lon) {
        const list = document.getElementById('stop-list');
        const query = `[out:json];node["highway"="bus_stop"](around:1000,${lat},${lon});out;`;
        const url = `https://overpass-api.de/api/interpreter?data=${encodeURIComponent(query)}`;

        try {
            const res = await fetch(url);
            const data = await res.json();
            
            list.innerHTML = '';
            if (data.elements.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:gray;">áƒáƒ®áƒšáƒáƒ›áƒáƒ®áƒšáƒ áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ”áƒ‘áƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ</p>';
                return;
            }

            data.elements.forEach(stop => {
                const name = stop.tags.name || "áƒáƒ•áƒ¢áƒáƒ‘áƒ£áƒ¡áƒ˜áƒ¡ áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ";
                L.marker([stop.lat, stop.lon], {
                    icon: L.divIcon({
                        className: 'custom-div-icon',
                        html: "<div style='background-color:#5d5fef; width:12px; height:12px; border-radius:50%; border:2px solid white;'></div>",
                        iconSize: [12, 12]
                    })
                }).addTo(map);

                list.innerHTML += `
                    <div class="stop-card">
                        <div class="stop-icon">ğŸš</div>
                        <div class="stop-info">
                            <b>${name}</b>
                            <span>áƒ›áƒ£áƒœáƒ˜áƒªáƒ˜áƒáƒáƒšáƒ£áƒ áƒ˜ áƒ¢áƒ áƒáƒœáƒ¡áƒáƒáƒ áƒ¢áƒ˜</span>
                        </div>
                    </div>`;
            });
        } catch (e) {
            list.innerHTML = '<p style="text-align:center; color:red;">áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ˜áƒ¡áƒáƒ¡</p>';
        }
    }
</script>
</body>
</html>





